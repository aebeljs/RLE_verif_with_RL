### Makefile for the rle_comp project
### Generated by Bluespec Workstation on Tue Apr  7 23:21:22 IST 2020

TOP_DIR:=.
TOP_FILE:=rle_compression.bsv
TOP_MODULE:=mkrle_compression
BSVBUILDDIR:=./build/
VERILOGDIR:=./verilog/
FILES:=$(TOP_DIR):./rle/:./coo/
BSVINCDIR:= .:%/Prelude:%/Libraries:%/Libraries/BlueNoC:$(FILES)

default: clean generate_verilog compile link simulate

.PHONY: compile
compile:
	@echo Compiling $(TOP_MODULE) in $(TOP_FILE)...
	@mkdir -p $(BSVBUILDDIR)
	@bsc -u -sim -simdir $(BSVBUILDDIR) -bdir $(BSVBUILDDIR) -info-dir $(BSVBUILDDIR) -keep-fires -p $(BSVINCDIR) -g $(TOP_MODULE)  $(TOP_DIR)/$(TOP_FILE) 
	@echo Compilation finished

.PHONY: link
link:
	@echo Linking $(TOP_MODULE) in $(TOP_FILE)...
	@mkdir -p bin
	@bsc -e $(TOP_MODULE) -sim -o ./bin/out -simdir $(BSVBUILDDIR) -p %/Prelude:%/Libraries:%/Libraries/BlueNoC -bdir $(BSVBUILDDIR) -keep-fires
	@echo Linking finished

.PHONY: simulate
simulate:
	@echo Simulation...
	./bin/out 
	@echo Simulation finished

.PHONY: generate_verilog 
generate_verilog:
	@echo generating verilog $(TOP_MODULE) in $(TOP_FILE)  ...
	@mkdir -p $(BSVBUILDDIR); 
	@mkdir -p $(VERILOGDIR); 
	@bsc -u -verilog -elab -vdir $(VERILOGDIR) -bdir $(BSVBUILDDIR) -info-dir $(BSVBUILDDIR)\
 -D verilog=True -p $(BSVINCDIR) -g $(TOP_MODULE) $(TOP_DIR)/$(TOP_FILE)\
  || (echo "BSC COMPILE ERROR"; exit 1) 


.PHONY: clean
clean:
	@rm -rf $(BSVBUILDDIR)
	@rm -rf $(VERILOGDIR)
	@rm -rf bin

